Outils utiles
============

* * * * *

De nombreux outils sont à notre disposition pour nous aider à énumérer les systèmes Windows pour les vecteurs d'escalade de privilèges courants et obscurs. Vous trouverez ci-dessous une liste de fichiers binaires et de scripts utiles, dont beaucoup seront couverts dans les prochaines sections du module.

| Outil | Descriptif |
| --- | --- |
| [Ceinture de sécurité](https://github.com/GhostPack/Seatbelt) | Projet C# pour effectuer une grande variété de contrôles d'escalade de privilèges locaux |
| [winPEAS](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS) | WinPEAS est un script qui recherche les chemins possibles pour élever les privilèges sur les hôtes Windows. Toutes les vérifications sont expliquées [ici](https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation) |
| [PowerUp](https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1) | Script PowerShell pour rechercher les vecteurs d'escalade de privilèges Windows courants qui reposent sur des configurations incorrectes. Il peut également être utilisé pour exploiter certains des problèmes trouvés |
| [SharpUp](https://github.com/GhostPack/SharpUp) | Version C# de PowerUp |
| [JAWS](https://github.com/411Hall/JAWS) | Script PowerShell pour énumérer les vecteurs d'escalade de privilèges écrits en PowerShell 2.0 |
| [SessionGopher](https://github.com/Arvanaghi/SessionGopher) | SessionGopher est un outil PowerShell qui trouve et décrypte les informations de session enregistrées pour les outils d'accès à distance. Il extrait les informations de session enregistrées PuTTY, WinSCP, SuperPuTTY, FileZilla et RDP |
| [Watson](https://github.com/rasta-mouse/Watson) | Watson est un outil .NET conçu pour énumérer les bases de connaissances manquantes et suggérer des exploits pour les vulnérabilités d'escalade de privilèges. |
| [LaZagne](https://github.com/AlessandroZ/LaZagne) | Outil utilisé pour récupérer les mots de passe stockés sur une machine locale à partir de navigateurs Web, d'outils de chat, de bases de données, de Git, d'e-mails, de vidages de mémoire, de PHP, d'outils d'administration système, de configurations de réseau sans fil, de mécanismes de stockage de mots de passe Windows internes, etc. |
| [Suggestion d'exploits Windows - Nouvelle génération](https://github.com/bitsadmin/wesng) | WES-NG est un outil basé sur la sortie de l'utilitaire `systeminfo` de Windows qui fournit la liste des vulnérabilités auxquelles le système d'exploitation est vulnérable, y compris les exploits de ces vulnérabilités. Tous les systèmes d'exploitation Windows entre Windows XP et Windows 10, y compris leurs homologues Windows Server, sont pris en charge |
| [Suite Sysinternals](https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite) | Nous utiliserons plusieurs outils de Sysinternals dans notre énumération, notamment [AccessChk](https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk), [PipeList](https://docs.microsoft.com/ en-us/sysinternals/downloads/pipelist) et [PsService](https://docs.microsoft.com/en-us/sysinternals/downloads/psservice) |

Nous pouvons également trouver des binaires pré-compilés de `Seatbelt` et `SharpUp` [ici](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries), et des binaires autonomes de `LaZagne` [ici](https:// github.com/AlessandroZ/LaZagne/releases/). Il est recommandé de toujours compiler nos outils à partir de la source si nous les utilisons dans un environnement client.

Remarque : Selon la manière dont nous accédons à un système, nous n'avons peut-être pas beaucoup de répertoires accessibles en écriture par notre utilisateur pour télécharger des outils. Il est toujours préférable de télécharger des outils dans `C:\Windows\Temp` car le groupe `BUILTIN\Users` a un accès en écriture.

Il ne s'agit pas d'une liste exhaustive des outils à notre disposition. De plus, nous devons nous efforcer d'apprendre ce que fait chaque outil si l'un ne fonctionne pas comme prévu, ou si nous ne pouvons pas les charger sur le système cible. Des outils comme ceux énumérés ci-dessus sont extrêmement utiles pour affiner nos vérifications et concentrer notre énumération. L'énumération d'un système Windows peut être une tâche ardue avec une immense quantité d'informations à parcourir et à interpréter. Les outils peuvent accélérer ce processus et nous donner également plus de résultats dans un format facile à lire. Un inconvénient à cela peut être la surcharge d'informations, car certains de ces outils, tels que `winPEAS`, renvoient une quantité incroyable d'informations qui ne nous sont généralement pas utiles. Les outils peuvent être une épée à double tranchant. Bien qu'ils aident à accélérer le processus d'énumération et nous fournissent des résultats très détaillés, nous pourrions travailler moins efficacement si nous ne savons pas comment lire les résultats ou les réduire aux points de données les plus intéressants. Les outils peuvent également produire de faux positifs, nous devons donc avoir une compréhension approfondie des nombreuses techniques d'escalade de privilèges possibles pour résoudre les problèmes lorsque les choses tournent mal ou ne sont pas ce qu'elles semblent être. Apprendre manuellement les techniques de dénombrement aidera à s'assurer que nous ne manquons pas de défauts évidents dus à un problème avec un outil, comme un faux négatif ou un faux positif.

Tout au long de ce module, nous montrerons des techniques d'énumération manuelle pour les différents exemples que nous couvrons et la sortie de l'outil, le cas échéant. Outre les techniques d'énumération, il est également essentiel d'apprendre à effectuer les étapes d'exploitation manuellement et de ne pas s'appuyer sur des scripts ou des outils "autopwn" que nous ne pouvons pas ccontrôle. C'est bien (et encouragé !) d'écrire nos propres outils/scripts pour effectuer à la fois les étapes d'énumération et d'exploitation. Néanmoins, nous devons être suffisamment confiants dans les deux phases pour expliquer précisément ce que nous faisons à notre client à n'importe quelle étape du processus. Nous devrions également pouvoir fonctionner dans un environnement où nous ne pouvons pas charger d'outils (comme un réseau isolé ou des systèmes qui n'ont pas accès à Internet ou nous permettent de brancher un périphérique externe tel qu'une clé USB).

Ces outils sont non seulement bénéfiques pour les testeurs d'intrusion, mais peuvent également aider les administrateurs système dans leur travail en aidant à identifier les fruits à portée de main à corriger avant une évaluation, en vérifiant périodiquement la posture de sécurité de quelques machines, en analysant l'impact d'une mise à niveau ou autre. modifications ou effectuer un examen de sécurité approfondi sur une nouvelle image Gold avant de la déployer en production. Les outils et méthodes présentés dans ce module peuvent bénéficier de manière significative à toute personne en charge de l'administration des systèmes, de l'architecture ou de la sécurité et de la conformité internes.

Comme pour toute automatisation, l'utilisation de ces outils peut présenter des risques. Bien que rare, une énumération excessive peut entraîner une instabilité du système ou des problèmes avec un système (ou des systèmes) dont la fragilité est déjà connue. De plus, ces outils sont bien connus, et la plupart (sinon tous) d'entre eux seront détectés et bloqués par les solutions antivirus courantes, et très certainement, par des produits EDR plus avancés tels que Cylance ou Carbon Black. Regardons la dernière version de l'outil `LaZagne` au moment de la rédaction de la version [2.4.3](https://github.com/AlessandroZ/LaZagne/releases/download/2.4.3/lazagne.exe). Le téléchargement du binaire précompilé sur Virus Total montre que 47/70 produits le détectent.

![image](https://academy.hackthebox.com/storage/modules/67/VT_detected2.png)

Nous aurions probablement été pris sur le coup si nous avions tenté de l'exécuter lors d'un engagement évasif. Lors d'autres évaluations, nous pouvons rencontrer des protections que nous devons contourner pour exécuter nos outils. Bien que hors de portée de ce module, nous pouvons utiliser diverses méthodes pour faire passer nos outils au-delà des produits audiovisuels courants, comme la suppression de commentaires, la modification des noms de fonction, le cryptage de l'exécutable, etc. Ces techniques seront enseignées dans un module ultérieur. Nous supposerons que notre client cible a temporairement configuré Windows Defender sur les hôtes que nous évaluons pour ne pas bloquer nos activités pour ce module. Ils recherchent autant de problèmes que possible et ne cherchent pas à tester leurs défenses à ce stade du jeu.
