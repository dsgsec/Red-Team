Validation absente
==================

* * * * *

Le type le plus élémentaire de vulnérabilité de téléchargement de fichiers se produit lorsque l'application Web «n'a aucune forme de filtres de validation» sur les fichiers téléchargés, permettant le téléchargement de n'importe quel type de fichier par défaut.

Avec ces types d'applications Web vulnérables, nous pouvons télécharger directement notre shell Web ou notre script de shell inversé sur l'application Web, puis en visitant simplement le script téléchargé, nous pouvons interagir avec notre shell Web ou envoyer le shell inversé.

* * * * *

Téléchargement de fichiers arbitraires
---------------------

Commençons l'exercice à la fin de cette section, et nous verrons une application Web de «Fichier de fichiers», qui nous permet de télécharger des fichiers personnels sur l'application Web:

![](https://academy.hackthebox.com/storage/modules/136/file_uploads_file_manager.jpg)

L'application Web ne mentionne rien sur les types de fichiers autorisés, et nous pouvons faire glisser et supprimer n'importe quel fichier que nous voulons, et son nom apparaîtra sur le formulaire de téléchargement, y compris les fichiers `.php`

![](https://academy.hackthebox.com/storage/modules/136/file_uploads_file_selected_php_file.jpg)

De plus, si nous cliquons sur le formulaire pour sélectionner un fichier, la boîte de dialogue de sélecteur de fichiers ne spécifie aucun type de fichier, car il indique «Tous les fichiers» pour le type de fichier, ce qui peut également suggérer qu'aucun type de restrictions ou limitations n'est spécifié pour L'application Web:

![exemple](https://academy.hackthebox.com/storage/modules/136/file_uploads_file_selection_dialog.jpg)

Tout cela nous indique que le programme semble n'avoir aucune restriction de type de fichier sur le frontal, et si aucune restriction n'a été spécifiée sur le back-end, nous pourrions être en mesure de télécharger des types de fichiers arbitraires sur le serveur back-end pour gagner Contrôle complet dessus.

* * * * *

Identification du framework Web
-------------------------

Nous devons télécharger un script malveillant pour tester si nous pouvons télécharger n'importe quel type de fichier sur le serveur back-end et tester si nous pouvons l'utiliser pour exploiter le serveur back-end. De nombreux types de scripts peuvent nous aider à exploiter les applications Web via un téléchargement de fichiers arbitraires, le plus souvent un script `shell '' et un script` shell 'inverse'.

Un shell Web nous fournit une méthode facile pour interagir avec le serveur back-end en acceptant les commandes shell et en imprimant leur sortie à nous dans le navigateur Web. Un shell Web doit être écrit dans le même langage de programmation qui exécute le serveur Web, car il exécute des fonctions et des commandes spécifiques à la plate-forme pour exécuter des commandes système sur le serveur back-end, créant des shells Web non conformes aux scripts non-plateaux. Ainsi, la première étape serait d'identifier la langue exécute l'application Web.

Ceci est généralement relativement simple, car nous pouvons souvent voir l'extension de la page Web dans les URL, ce qui peut révéler le langage de programmation qui exécute l'application Web. Cependant, dans certains cadres Web et langages Web, les «routes Web» sont utilisés pour cartographier les URL sur les pages Web, auquel cas l'extension de la page Web peut ne pas être affichée. De plus, l'exploitation de téléchargement de fichiers serait également différente, car nos fichiers téléchargés peuvent ne pas être directement routibles ou accessibles.

Une méthode facile pour déterminer quelle langue exécute l'application Web consiste à visiter la page `/ index.EXT`, où nous échangerions` EXT` avec diverses extensions Web communes, comme `php`,` asp`, `aspx`, entre autres, pour voir s'il existe l'un d'eux.

Par exemple, lorsque nous visitons notre exercice ci-dessous, nous voyons son URL comme `http: // server_ip: port /`, car la page `INDEX` est généralement masquée par défaut. Mais, si nous essayons de visiter `http: // server_ip: port / index.php`, nous obtiendrions la même page, ce qui signifie qu'il s'agit en effet d'une application Web` Php`. Nous n'avons pas besoin de le faire manuellement, bien sûr, car nous pouvons utiliser un outil comme Burp Intruder pour fuzzing l'extension de fichier à l'aide d'une [extensions Web] (https://github.com/danielmiesler/seclists/blob/master/discovery/Web-conent/web-extensions.txt) Wordlist, comme nous le verrons dans les sections à venir. Cette méthode peut ne pas toujours être exacte, car l'application Web peut ne pas utiliser des pages d'index ou utiliser plus d'une extension Web.

Plusieurs autres techniques peuvent aider à identifier les technologies exécutant l'application Web, comme l'utilisation de l'extension [wappalyzer] (https://www.wappalyzer.com/), qui est disponible pour tous les principaux navigateurs. Une fois ajouté à notre navigateur, nous pouvons cliquer sur son icône pour afficher toutes les technologies exécutant l'application Web:

![exemple](https://academy.hackthebox.com/storage/modules/136/file_uploads_wappalyzer.jpg)

Comme nous pouvons le voir, non seulement l'extension nous a dit que l'application Web s'exécute sur «PHP», mais elle a également identifié le type et la version du serveur Web, le système d'exploitation arrière et d'autres technologies utilisées. Ces extensions sont essentielles dans l'arsenal d'un testeur de pénétration Web, bien qu'il soit toujours préférable de connaître des méthodes manuelles alternatives pour identifier le cadre Web, comme la méthode précédente dont nous avons discuté.

Nous pouvons également exécuter des scanners Web pour identifier le cadre Web, comme les scanners Burp / Zap ou d'autres outils d'évaluation de la vulnérabilité Web. En fin de compte, une fois que nous avons identifié la langue exécutée le web applIcation, nous pouvons télécharger un script malveillant écrit dans la même langue pour exploiter l'application Web et obtenir une télécommande sur le serveur arrière.

* * * * *

Identification de la vulnérabilité
----------------------------

Maintenant que nous avons identifié le framework Web exécutant l'application Web et son langage de programmation, nous pouvons tester si nous pouvons télécharger un fichier avec la même extension. En tant que test initial pour identifier si nous pouvons télécharger des fichiers «php» arbitraires, créons un script `` Hello World '' de base pour tester si nous pouvons exécuter le code `PHP 'avec notre fichier téléchargé.

Pour ce faire, nous écrivons `<? Php echo" Hello HTB ";?>` À `test.php`, et essayez de le télécharger sur l'application Web:

![](https://academy.hackthebox.com/storage/modules/136/file_uploads_upload_php.jpg)

Le fichier semble avoir été téléchargé avec succès, car nous recevons un message indiquant que «le fichier a réussi à télécharger», ce qui signifie que «l'application Web n'a aucune validation de fichier sur le back-end». Maintenant, nous pouvons cliquer sur le bouton «Télécharger» et l'application Web nous amènera dans notre fichier téléchargé:

![](https://academy.hackthebox.com/storage/modules/136/file_uploads_hello_htb.jpg)

Comme nous pouvons le voir, la page imprime notre message «Hello HTB», ce qui signifie que la fonction «Echo» a été exécutée pour imprimer notre chaîne, et nous avons exécuté avec succès le code `PHP» sur le serveur arrière. Si la page ne pouvait pas exécuter le code PHP, nous verrions notre code source imprimé sur la page.

Dans la section suivante, nous verrons comment exploiter cette vulnérabilité pour exécuter du code sur le serveur arrière et prendre le contrôle dessus.