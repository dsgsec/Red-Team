Attaques d'authentification classiques
======================================

Les attaques d'authentification classiques incluent des techniques qui existent depuis un certain temps, comme le forçage brutal et la pulvérisation de mots de passe. Ces deux attaques sont des méthodes différentes pour deviner les combinaisons de nom d'utilisateur et de mot de passe. Il s'agit de vulnérabilités inhérentes à chaque fois que l'authentification de base est déployée. Pour s'authentifier à l'aide de cette authentification de base, le consommateur émet une demande contenant un nom d'utilisateur et un mot de passe, puis le fournisseur effectue une vérification pour s'assurer que la combinaison correspond aux enregistrements stockés dans une base de données. Comme nous le savons, les API RESTful ne conservent pas d'état, donc si l'API devait tirer parti de l'authentification de base sur tous les points de terminaison, un nom d'utilisateur et un mot de passe devraient être émis à chaque fois. Au lieu de cela, le fournisseur peut tirer parti de l'authentification de base une fois en utilisant un portail d'authentification, puis en fournissant les informations d'identification correctes, Examinons crAPI pour un exemple de ce processus.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/AwLw7oI5TzeeirccxdXT_AuthenticationAttacks1.PNG)

Ainsi, les fournisseurs utilisent généralement l'authentification de base uniquement dans le cadre d'un processus de connexion initial. C'est exactement ce que nous avons vu avec crAPI. Après une requête POST réussie à /identity/api/auth/login, les utilisateurs reçoivent un jeton porteur. Les attaques d'authentification classiques dans cette section incluent les attaques par force brute de mot de passe avec encodage base64, la force brute de réinitialisation de mot de passe et la pulvérisation de mot de passe. 

Attaques par force brute par mot de passe
-----------------------------------------

L'une des méthodes les plus simples pour accéder à une API consiste à effectuer une attaque par force brute. Le forçage brutal de l'authentification d'une API n'est pas très différent de toute autre attaque par force brute, sauf que vous enverrez la demande à un point de terminaison d'API, la charge utile sera souvent au format JSON et les valeurs d'authentification peuvent nécessiter un encodage base64.

L'un des meilleurs moyens d'affiner votre attaque par force brute consiste à générer des mots de passe spécifiques à votre cible. Pour ce faire, vous pouvez exploiter les informations révélées par une vulnérabilité d'exposition excessive des données, comme celle que vous avez trouvée dans le module Endpoint Analysis, pour compiler une liste de noms d'utilisateur et de mots de passe. Les données excédentaires pourraient révéler des détails techniques sur le compte de l'utilisateur, par exemple si l'utilisateur utilisait une authentification multifacteur, s'il avait un mot de passe par défaut et si le compte a été activé. Si les données excédentaires impliquaient des informations sur l'utilisateur, vous pouvez les transmettre à des outils capables de générer de grandes listes de mots de passe ciblées pour les attaques par force brute.

Pour plus d'informations sur la création de listes de mots de passe ciblées, consultez l'application Mentalist (https://github.com/sc0tfree/mentalist) ou le Common User Passwords Profiler (https://github.com/Mebus/cupp).

Pour effectuer réellement l'attaque par force brute une fois que vous avez une liste de mots appropriée, vous pouvez utiliser des outils tels que Intruder ou Wfuzz de Burp Suite. L'exemple suivant utilise Wfuzz avec une ancienne liste de mots de passe bien connue, rockyou.txt. Rockyou.txt est une liste de mots standard sur Kali Linux, cependant, il est actuellement compressé avec Gzip. Vous pouvez décompresser rockyou.txt en utilisant la commande suivante.

$gzip -d /usr/share/wordlists/rockyou.txt.gz

Avant, nous plongeons dans l'utilisation de WFuzz, traitons cela comme un vrai test. Plus tôt, nous avons découvert une vulnérabilité d'exposition excessive des données avec une demande au forum de la communauté crAPI. Rassemblons les adresses e-mail de cette demande pour créer un mot de passe.

Pour commencer avec WFuzz, accédez au menu d'aide et lisez les options pour avoir une meilleure idée de ce qui peut être fait avec cet outil.\
$wfuzz --aide

Les éléments importants à noter pour les tests d'API incluent l'option d'en-têtes (-H), les réponses masquées (--hc, --hl, --hw, --hh) et les requêtes de corps POST (-d). Tous ces éléments seront utiles lors du fuzzing des API. Nous devrons spécifier les en-têtes de type de contenu pour les API qui seront 'Content-Type: application/json' pour crAPI. Le corps POST pour la connexion crAPI est ' {"email":" a@email.com ","password":"FUZZ"}'. Notez que FUZZ est la position d'attaque WFuzz. Enfin, si nous obtenons de nombreuses réponses non pertinentes, nous pouvons nettoyer notre attaque en masquant certaines réponses. Pour l'attaque par force brute suivante, il est recommandé de n'attaquer que votre propre environnement de laboratoire. Si de nombreux étudiants tentaient des attaques par force brute contre les laboratoires hébergés, cela pourrait entraîner l'échec des applications.  

$ wfuzz -d '{"email":" a@email.com ","password":"FUZZ"}' -H 'Type de contenu : application/json' -z fichier,/usr/share/wordlists/rockyou .txt -u http://127.0.0.1:8888/identity/api/auth/login --hc 405 ======================== ======================================== ID Lignes de réponse Word Chars Charge utile === ================================================= ============= 000000007 : 200 0 L 1 W 225 Ch "Mot de passe1!" 000000005 : 400 0 L 34 W 474 Ch "gagner"

L'option -d vous permet de fuzzer le contenu envoyé dans le corps d'une requête POST. Les accolades qui suivent contiennent le corps de la requête POST. Pour découvrir le format de requête utilisé dans cet exemple, j'ai tenté de m'authentifier auprès d'une application Web à l'aide d'un navigateur, puis j'ai capturé la tentative d'authentification et reproduit sa structure ici. Dans ce cas, l'application Web émet une requête POST avec les paramètres "email" et "password". La structure de ce corps changera pour chaque API. Dans cet exemple, vous pouvez voir que nous avons spécifié un e-mail connu et utilisé le paramètre FUZZ comme mot de passe. L'option --hc masque les réponses avec certains codes de réponse. Ceci est utile si vous recevez souvent le même code d'état, la même longueur de mot et le même nombre de caractères dans de nombreuses requêtes. Si vous savez à quoi ressemble une réponse d'échec typique pour votre cible, il n'est pas nécessaire de voir des centaines ou des milliers de cette même réponse. L'option --hc vous aide à filtrer les réponses que vous ne voulez pas voir. Dans l'instance testée, la requête échouée typique entraîne un code d'état 405, mais cela peut également différer avec chaque API. Ensuite, l'option -H vous permet d'ajouter un en-tête à la requête. Certains fournisseurs d'API peuvent répondre avec un code d'erreur HTTP 415 Type de média non pris en charge si vous n'incluez pas l'en-tête Content -Type:application/json lors de l'envoi de données JSON dans le corps de la requête. Une fois votre demande envoyée, vous pouvez consulter les résultats sur la ligne de commande. Si votre option --hc Wfuzz a fonctionné, vos résultats devraient être assez faciles à lire. Sinon,

Pulvérisation de mot de passe
-----------------------------

De nombreux contrôles de sécurité peuvent vous empêcher de forcer avec succès l'authentification d'une API. Une technique appelée pulvérisation de mots de passe peut échapper à bon nombre de ces contrôles en combinant une longue liste d'utilisateurs avec une courte liste de mots de passe ciblés. Disons que vous savez qu'un processus d'authentification API a une politique de verrouillage en place et n'autorisera que 10 tentatives de connexion. Vous pouvez créer une liste des neuf mots de passe les plus probables (un mot de passe de moins que la limite) et les utiliser pour tenter de vous connecter à de nombreux comptes d'utilisateurs. Lorsque vous vaporisez un mot de passe, les listes de mots volumineuses et obsolètes comme rockyou.txt ne fonctionneront pas. Il y a beaucoup trop de mots de passe improbables dans un tel fichier pour réussir. Au lieu de cela, créez une courte liste de mots de passe probables, en tenant compte des contraintes de la politique de mot de passe du fournisseur d'API, que vous pouvez découvrir lors de la reconnaissance. La plupart des stratégies de mot de passe exigent probablement une longueur minimale de caractères, des lettres majuscules et minuscules, et peut-être un chiffre ou un caractère spécial. Utilisez des mots de passe suffisamment simples à deviner mais suffisamment complexes pour répondre aux exigences de base en matière de mot de passe (généralement un minimum de huit caractères, un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! lettres majuscules et minuscules, et peut-être un chiffre ou un caractère spécial. Utilisez des mots de passe suffisamment simples à deviner mais suffisamment complexes pour répondre aux exigences de base en matière de mot de passe (généralement un minimum de huit caractères, un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! lettres majuscules et minuscules, et peut-être un chiffre ou un caractère spécial. Utilisez des mots de passe suffisamment simples à deviner mais suffisamment complexes pour répondre aux exigences de base en matière de mot de passe (généralement un minimum de huit caractères, un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! Utilisez des mots de passe suffisamment simples à deviner mais suffisamment complexes pour répondre aux exigences de base en matière de mot de passe (généralement un minimum de huit caractères, un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! Utilisez des mots de passe suffisamment simples à deviner mais suffisamment complexes pour répondre aux exigences de base en matière de mot de passe (généralement un minimum de huit caractères, un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! un symbole, des lettres majuscules et minuscules et un chiffre). Le premier type comprend des mots de passe évidents comme QWER!@#$, Password1!, et la formule Saison+Année+Symbole (comme Hiver2021!, Printemps2021?, Automne2021! et Automne2021?). Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 ! Le deuxième type comprend des mots de passe plus avancés qui se rapportent directement à la cible, comprenant souvent une lettre majuscule, un chiffre, un détail sur l'organisation et un symbole. Voici une courte liste de pulvérisation de mots de passe que je pourrais générer si j'attaquais un endpoint pour les employés de Twitter : Summer2022 ! Printemps 2022 ! QWER !@#$21mars2006 ! 15 juillet 2006 !Twitter@2022 JPD1976 ! [Dorsey@2022](mailto:Dorsey@2021)

La véritable clé de la pulvérisation de mots de passe est de maximiser votre liste d'utilisateurs. Plus vous incluez de noms d'utilisateur, plus vous avez de chances de compromettre un compte d'utilisateur avec un mauvais mot de passe. Créez une liste d'utilisateurs lors de vos efforts de reconnaissance ou en découvrant des vulnérabilités d'exposition excessive des données. Revoyons l'exposition excessive aux données crAPI que nous avons découverte plus tôt dans le cours. 

Capture d'écran Postman d'une exposition excessive aux données.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/DoOMnCRoTMKs3JW0ny1Q_classicauth8.PNG)

En haut à droite du volet Postman Response, sélectionnez "Enregistrer cette réponse" puis "Enregistrer dans un fichier". Enregistrez la réponse contenant une exposition excessive des données sous "response.json".

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/XzF8TuRxmP2jJnJUx0wI_classicauth9.PNG)

Ensuite, vous pouvez utiliser la puissance de grep et des expressions régulières pour extraire les e-mails de la réponse JSON enregistrée.

$grep -oe "[a-zA-Z0-9._]\+@[a-zA-Z]\+.[a-zA-Z]\+" réponse.json

  ![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/Caok1enSA2ImyEnx14sQ_classicauth1.PNG)

L'utilisation de cette commande grep devrait tout extraire d'un fichier qui ressemble à un e-mail. Ensuite, vous pouvez enregistrer ces e-mails capturés dans un fichier et utiliser ce fichier comme charge utile dans Burp Suite. Vous pouvez ensuite utiliser une commande telle que  sort -u pour vous débarrasser des e-mails en double.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/Vuru9fDrTPCumgiKmLgr_classicauth10.PNG)

Dans Intruder de Burp Suite, vous pouvez configurer cette attaque de la même manière que l'attaque par force brute standard, sauf que vous utiliserez à la fois une liste d'utilisateurs et une liste de mots de passe. Choisissez le type d'attaque à la bombe à fragmentation et définissez les positions d'attaque autour du nom d'utilisateur et du mot de passe, comme indiqué ci-dessous.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/5Mn8meMnSrS0uOknheYG_classicauth2.PNG)

Notez que la première position d'attaque est définie pour remplacer le nom d'utilisateur devant @email.com, ce que vous pouvez faire si vous testez uniquement les utilisateurs d'un domaine de messagerie spécifique. Ensuite, ajoutez la liste des utilisateurs collectés en tant que premier ensemble de données utiles et une courte liste de mots de passe en tant que deuxième ensemble de données utiles. Une fois vos charges utiles configurées, vous êtes prêt à effectuer une attaque par pulvérisation de mot de passe.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/tmVBtpaRS7yI3pB4i66i_classicauth11.PNG)

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/XdFiVq8dQGuLAp7PGPAM_classicauth4.PNG)

Lorsque vous analysez les résultats, il est utile d'avoir une idée de ce à quoi ressemble une connexion réussie standard. Si vous n'êtes pas sûr, recherchez les anomalies dans les longueurs et les codes de réponse renvoyés. La plupart des applications Web répondent aux résultats de connexion réussis avec un code d'état HTTP dans les 200 ou 300 et la longueur de réponse des réponses réussies sera différente de celle des réponses infructueuses.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/BROE3AStTqWI3C73sAHK_classicauth5.PNG)

Vous pouvez voir une tentative de pulvérisation de mot de passe réussie qui présente deux caractéristiques anormales : un code d'état de 200 et une longueur de réponse de 698. Pour aider à repérer les anomalies à l'aide d'Intruder, vous pouvez trier les résultats par code d'état ou longueur de réponse.

### Remarque sur l'encodage Base64

Certaines API coderont en base64 les charges utiles d'authentification envoyées dans une demande d'API. Il existe de nombreuses raisons de le faire, mais il est important de savoir que la sécurité n'en fait pas partie. Vous pouvez facilement contourner ce petit inconvénient. Si vous testez une tentative d'authentification et remarquez qu'une API est encodée en base64, elle effectue probablement une comparaison avec les informations d'identification encodées en base64 sur le backend. Cela signifie que vous devez ajuster vos attaques fuzzing pour inclure les charges utiles base64 à l'aide de Burp Suite Intruder, qui peut à la fois encoder et décoder les valeurs base64. 

Vous pouvez les décoder en mettant en surbrillance la charge utile, en cliquant avec le bouton droit de la souris et en sélectionnant Base64-decode (ou le raccourci CTRL-SHIFT-B). Cela révélera la charge utile afin que vous puissiez voir comment elle est formatée. Pour effectuer, par exemple, une attaque par pulvérisation de mot de passe à l'aide de l'encodage base64, commencez par sélectionner les positions d'attaque. Dans ce cas, nous sélectionnerons le mot de passe encodé en base64 dans la requête. Ensuite, ajoutez l'ensemble de données utiles ; nous utiliserons les mots de passe répertoriés dans la section précédente. Désormais, afin de coder chaque mot de passe avant qu'il ne soit envoyé dans une requête, nous devons utiliser une règle de traitement de la charge utile. Sous l'onglet Payloads se trouve une option pour ajouter une telle règle. Sélectionnez Ajouter>Encodé>Encodage Base64, puis cliquez sur OK. Votre fenêtre de traitement de la charge utile devrait ressembler à ceci.

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/tCAhOd1QlGRxphRs1oBA_classicauth6.PNG)

Une fois que votre règle de traitement de la charge utile est en place, vous pouvez effectuer une attaque normalement. Lorsque vous examinez des résultats anormaux, vous pouvez simplement utiliser CTRL + Maj + B ou utiliser l'option de sélection de conversion en mettant en surbrillance et en cliquant avec le bouton droit sur la charge utile. 

![](https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/site/2147573912/products/wQ2ZI4B0S3u8KiWbE9lZ_classicauth7.PNG)

 Dans la section suivante, nous concentrerons nos efforts sur l'analyse et l'attaque des jetons API.
