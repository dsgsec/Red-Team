Exploiter la validation défectueuse des téléchargements de fichiers
-------------------------------------------------------------------

Dans la nature, il est peu probable que vous trouviez un site Web qui n'a aucune protection contre les attaques de téléchargement de fichiers comme nous l'avons vu dans le laboratoire précédent. Mais ce n'est pas parce que les défenses sont en place qu'elles sont robustes. Vous pouvez parfois encore exploiter les failles de ces mécanismes pour obtenir un shell web pour l'exécution de code à distance.

Validation du type de fichier
-----------------------------

Lors de l'envoi de formulaires HTML, le navigateur envoie généralement les données fournies dans un `POST` demande avec le type de contenu `application/x-www-form-url-encoded`. C'est très bien pour envoyer du texte simple comme votre nom ou votre adresse. Cependant, il ne convient pas pour envoyer de grandes quantités de données binaires, comme un fichier image entier ou un document PDF. Dans ce cas, le type de contenu `multipart/form-data` est préféré.


Validation du type de fichier défectueux - Suite
------------------------------------------------

Considérez un formulaire contenant des champs pour télécharger une image, en fournir une description et entrer votre nom d'utilisateur. Soumettre un tel formulaire pourrait entraîner une demande qui ressemble à ceci:

`POST /images HTTP/1.1 Host: normal-website.com Content-Length: 12345 Content-Type: multipart/form-data; boundary=---------------------------012345678901234567890123456 ---------------------------012345678901234567890123456 Content-Disposition: form-data; name="image"; filename="example.jpg" Content-Type: image/jpeg [...binary content of example.jpg...] ---------------------------012345678901234567890123456 Content-Disposition: form-data; name="description" This is an interesting description of my image. ---------------------------012345678901234567890123456 Content-Disposition: form-data; name="username" wiener ---------------------------012345678901234567890123456--`

Comme vous pouvez le voir, le corps du message est divisé en parties distinctes pour chacune des entrées du formulaire. Chaque partie contient un `Content-Disposition` en-tête, qui fournit des informations de base sur le champ d'entrée auquel il se rapporte. Ces parties individuelles peuvent également contenir les leurs `Content-Type` en-tête, qui indique au serveur le type MIME des données soumises à l'aide de cette entrée.

Validation du type de fichier défectueux - Suite
Une façon que les sites Web peuvent tenter de valider les téléchargements de fichiers est de vérifier que cette entrée spécifique Content-Type l'en-tête correspond à un type MIME attendu. Si le serveur n'attend que des fichiers image, par exemple, il ne peut autoriser que des types tels que image/jpeg et image/png. Des problèmes peuvent survenir lorsque la valeur de cet en-tête est implicitement approuvée par le serveur. Si aucune autre validation n'est effectuée pour vérifier si le contenu du fichier correspond réellement au type MIME supposé, cette défense peut être facilement contournée à l'aide d'outils tels que Burp Repeater.
